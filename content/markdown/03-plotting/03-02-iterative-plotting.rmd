---
output:
  pdf_document: default
  html_document: default
---
# Introduction to `ggplot2`
**Author:** Cole Brookson
**Date:** 20 July 2022

```{r, echo=FALSE}
options(tidyverse.quiet = TRUE)
```

When making a plot, typically the best way to go about it is to iteratively make a version of the plot, observe the outcome, and then make changes in an iterative fashion. This prevents us from making mistakes in a long set of code that we then can't diagnose the problem with, and further, helps us catch mistakes (typos, colour problems, etc) as we only have to take in a few new components each time, and not a whole pile. 

For our example, let's use the example from the (LINK) Intro to `ggplot2` section, looking at salamanders and trout: 

```{r}
library(tidyverse)
library(lterdatasampler)

df <- lterdatasampler::and_vertebrates

names(df)
```

## Building a Basic Plot

Let's again plot a scatter plot of `length_1_mm` vs. `weight_g`. We'll start out with the absolute minimum number of arguments: 

1. The call to `ggplot()`
2. The aesthetics (i.e. what variables we want on the x- and y-axis)
3. The `geom_` function denoting what *type* of plot we're going for

```{r}
ggplot() +
  geom_point(data = df, aes(x = length_1_mm, y = weight_g))
```

Ok so we see our plot! Perfect. So the first thing to do, before we make any stylistic additions, is to deal with the components of the plot that are *must-haves* to have a legible, complete plot. First step is the axis labels. So to iteratively work up our plot, we'll add that one component on, by using the new function `labs()`:

```{r}
ggplot() +
  geom_point(data = df, aes(x = length_1_mm, y = weight_g)) +
  labs(x = "Length (mm)", y = "Weight (g)") 
```

OK good. Now, this is more aesthetic than anything, but we might want to change the appearance of this plot away from this ugly grey background and grid lines. This is a more personal decision regarding what exactly you want your plot to look like. However, there are lots of `themes` available in the `ggplot2` package to choose from. For example, we could use the `theme_classic()` like so: 

```{r}
ggplot() +
  geom_point(data = df, aes(x = length_1_mm, y = weight_g)) +
  labs(x = "Length (mm)", y = "Weight (g)") +
  theme_classic()
```

But I *personally* prefer a different theme that comes in the `ggthemes` package, which we can install now:

```{r}
install.packages("ggthemes")
library(ggthemes)
```

Now, let's use the `theme_base()` option, which will give us a very classic look and feel to the plot: 

```{r}
ggplot() +
  geom_point(data = df, aes(x = length_1_mm, y = weight_g)) +
  labs(x = "Length (mm)", y = "Weight (g)") +
   # note here we use `ggthemes::` to indicate which package we're using
  ggthemes::theme_base()
```

Perfect! You'll also notice the text sizes are now larger which is preferable for reading on a screen or in a report. 

## Adding Colour & Shape

Let's now add a colour to our points and change the shape we're using as well. 

**Note:** Arguments like this go in the `aes()` section, but there is a difference between simply assigning a colour and using colour to group points. To start, we'll just make the colour *red*, change the shape to my personal favourite, and up the size just a smidge: 

```{r}
ggplot() +
  geom_point(data = df, aes(x = length_1_mm, y = weight_g),
             # here's where we'll add our colour etc
             colour = "red", shape = 21, size = 2) +
  labs(x = "Length (mm)", y = "Weight (g)") +
   # note here we use `ggthemes::` to indicate which package we're using
  ggthemes::theme_base()
```

So this is interesting! We see that somehow we've made our points hollow on the inside. Well, that has to do with the shape we picked. There are lots of options for shapes we *could* use, and we can see all our options in this handy graphic here: 

![shapes](./img/r-symbols.png)

So notice we specified point # 21. This point has a dark outer circle and a fill colour in the middle. **When using a point option with an outter boundary and an inner fill, the argument `colour` refers to the outter boundary line, and the argument `fill` refers to the colour filling inside**. Let's see how this works by changing `colour = "black"` and `fill = "red"`: 

```{r}
ggplot() +
  geom_point(data = df, aes(x = length_1_mm, y = weight_g),
             # here's where we'll add our colour etc
             colour = "black", fill = "red", shape = 21, size = 2) +
  labs(x = "Length (mm)", y = "Weight (g)") +
   # note here we use `ggthemes::` to indicate which package we're using
  ggthemes::theme_base()
```

Okay, so this looks like maybe more along the lines of what we were expecting! One more thing though is that some spots on the plot have a high density of points. To better identify those high density areas, let's make our points slightly transparent, with the `alpha` commmand: 

```{r}
ggplot() +
  geom_point(data = df, aes(x = length_1_mm, y = weight_g),
             # here's where we'll add our colour etc
             colour = "black", fill = "red", shape = 21, alpha = 0.2, size = 2)+
  labs(x = "Length (mm)", y = "Weight (g)") +
   # note here we use `ggthemes::` to indicate which package we're using
  ggthemes::theme_base()
```


And now we can see where there really are many points. 

## Variables by Group

One of the most useful things to be able to do is group our points by either shape, fill, colour, or even size to show some difference betwen them. For example, in these data, we can see two very clearly different trends. 

```{r}
ggplot() +
  geom_point(data = df, aes(x = length_1_mm, y = weight_g, fill = species),
             # here's where we'll add our colour etc
             colour = "black", shape = 21, alpha = 0.2, size = 2)+
  labs(x = "Length (mm)", y = "Weight (g)") +
   # note here we use `ggthemes::` to indicate which package we're using
  ggthemes::theme_base()
```

So we can see our two main point colours plotted out nicely here. Although, there should be four colours and we can't really see them. Let's change our `alpha` to fix that: 

```{r}
ggplot() +
  geom_point(data = df, aes(x = length_1_mm, y = weight_g, fill = species),
             # here's where we'll add our colour etc
             colour = "black", shape = 21, alpha = 0.4, size = 2)+
  labs(x = "Length (mm)", y = "Weight (g)") +
   # note here we use `ggthemes::` to indicate which package we're using
  ggthemes::theme_base()
```

That's better. Looking at this plot, this brings up a few common tasks we might want to do from here. First of all, it's clear from this plot that the vast majority of these points are only from two species. We can see how the samples in our dataframe fall out with the simple `table()` function: 

```{r}
table(df$species)
```

So there are only 15 of the Cascade salamanders, and we know from our plot, at least a few NA's. Now the following decisions depend HIGHLY on what message one is trying to communicate with the plot, but we could imagine a scenario wherein perhaps it's actually important to have the Cascade salamander points be visible. But, it's clear from our plot, we may first want to get rid of NA's at least fo this plot. So let's do that via a `filter()` (LINK TO FILTERING AND SUBSETTING)

```{r}
df_filtered <- df %>% 
  dplyr::filter(!is.na(species))
head(df_filtered)
```

Okay, let's go ahead and make our plot again: 

```{r}
ggplot() +
  geom_point(data = df_filtered, # using the new dataframe
             aes(x = length_1_mm, y = weight_g, fill = species),
             # here's where we'll add our colour etc
             colour = "black", shape = 21, alpha = 0.4, size = 2)+
  labs(x = "Length (mm)", y = "Weight (g)") +
   # note here we use `ggthemes::` to indicate which package we're using
  ggthemes::theme_base()
```

This looks better. Now perhaps one way we could make the Cascade salamander points stand out is by making them significantly larger in size. We can do that my scaling our size manually according to the levels of our grouping variable. **Note, that scaling, whether manually or otherwise, can be done for all grouping aesthetics such as fill, colour, alpha, etc. Further documentation on this topic can be found on the [ggplot2 website](https://ggplot2.tidyverse.org/reference/scale_manual.html)**

```{r}
ggplot() +
  geom_point(data = df_filtered, # using the new dataframe
             aes(x = length_1_mm, y = weight_g, fill = species, size = species),
             # here's where we'll add our colour etc
             colour = "black", shape = 21, alpha = 0.4)+
  labs(x = "Length (mm)", y = "Weight (g)") +
   # note here we use `ggthemes::` to indicate which package we're using
  ggthemes::theme_base() +
  scale_size_manual(values = c(4, 1, 1))
  
```

Hmm. We can vaguely see in the bottom corner the points we want, but they're hard to see. Why is this? Well, the problem here can be identified as likely related to a problem of the data type. I suspect that `species` is not yet a factor, and that the order of the species will need to be changed. 

```{r}
class(df_filtered$species)
```

It is in fact a character. Let's change it to a factor:

```{r}
df_filtered$species <- as.factor(df_filtered$species)
class(df_filtered$species)
```
So now that it's a factor, let's look at the levels of the factor: 
```{r}
levels(df_filtered$species)
```
And we'll try the plot again: 

```{r}
ggplot() +
  geom_point(data = df_filtered, # using the new dataframe
             aes(x = length_1_mm, y = weight_g, fill = species, size = species),
             # here's where we'll add our colour etc
             colour = "black", shape = 21, alpha = 0.4)+
  labs(x = "Length (mm)", y = "Weight (g)") +
   # note here we use `ggthemes::` to indicate which package we're using
  ggthemes::theme_base() +
  scale_size_manual(values = c(4, 1, 1))
```

























